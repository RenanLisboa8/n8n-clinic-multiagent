# ====================================
# n8n Clinic Multi-Agent System
# PRODUCTION Environment Configuration
# ====================================
# 
# CRITICAL SECURITY NOTES:
# 1. This file contains production settings
# 2. Generate ALL secrets using secure methods (see commands below)
# 3. NEVER commit this file to version control
# 4. Keep backups in a secure location (encrypted)
# 5. Rotate secrets regularly (every 90 days recommended)
#
# SETUP INSTRUCTIONS:
# 1. Copy this file: cp env.production.example .env
# 2. Generate all required secrets (commands below)
# 3. Fill in ALL <REQUIRED> values
# 4. Verify all settings before deployment
# 5. Test in staging environment first
#
# GENERATE SECRETS:
# openssl rand -base64 32  # For encryption keys, JWT secrets, passwords
# openssl rand -hex 32     # For API keys
#
# ====================================

# ====================================
# GENERAL CONFIGURATION
# ====================================
TZ=America/Sao_Paulo
ENVIRONMENT=production
NODE_ENV=production

# ====================================
# POSTGRESQL DATABASE
# ====================================
POSTGRES_USER=n8n_clinic_prod
POSTGRES_PASSWORD=<REQUIRED - Use: openssl rand -base64 32>
POSTGRES_DB=n8n_clinic_production
POSTGRES_PORT=5432

# Database Connection (Internal)
DB_CONNECTION_STRING=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}

# ====================================
# REDIS CACHE
# ====================================
REDIS_PASSWORD=<REQUIRED - Use: openssl rand -hex 32>
REDIS_MAX_MEMORY=512mb
REDIS_PORT=6379

# Redis Connection (Internal)
REDIS_CONNECTION_STRING=redis://:${REDIS_PASSWORD}@redis:6379

# ====================================
# EVOLUTION API (WhatsApp)
# ====================================
EVOLUTION_BASE_URL=<REQUIRED - Example: https://api.yourdomain.com>
EVOLUTION_API_KEY=<REQUIRED - Use: openssl rand -hex 32>
EVOLUTION_PORT=8080
EVOLUTION_INSTANCE_NAME=clinic_production_instance

# WhatsApp Configuration
WA_CONNECTION_TIMEOUT=60000
WA_RECONNECT_INTERVAL=5000
WA_PHONE_CLIENT=Clínica Atendimento
QRCODE_LIMIT=30
EVOLUTION_LOG_LEVEL=WARN

# ====================================
# N8N WORKFLOW AUTOMATION
# ====================================
N8N_PORT=5678
N8N_PROTOCOL=https
N8N_WEBHOOK_URL=<REQUIRED - Example: https://n8n.yourdomain.com/>
N8N_HOST=0.0.0.0

# Database Schema
N8N_DB_SCHEMA=public

# Security & Encryption (CRITICAL - DO NOT LOSE THESE KEYS!)
N8N_ENCRYPTION_KEY=<REQUIRED - Use: openssl rand -base64 32 - BACKUP THIS KEY!>
N8N_JWT_SECRET=<REQUIRED - Use: openssl rand -base64 32>

# Execution Settings
N8N_EXECUTIONS_TIMEOUT=300
N8N_EXECUTIONS_TIMEOUT_MAX=3600
N8N_SAVE_ON_ERROR=all
N8N_SAVE_ON_SUCCESS=all
N8N_SAVE_ON_PROGRESS=true
N8N_DATA_MAX_AGE=168

# Logging
N8N_LOG_LEVEL=info
N8N_LOG_OUTPUT=console,file

# Features
N8N_METRICS=true
N8N_DIAGNOSTICS_ENABLED=false
N8N_PERSONALIZATION_ENABLED=false

# API Endpoints
N8N_ENDPOINT_REST=rest
N8N_ENDPOINT_WEBHOOK=webhook
N8N_ENDPOINT_WEBHOOK_TEST=webhook-test

# Error Handling
ERROR_WORKFLOW_ID=<OPTIONAL - Will be set after importing Error Handler workflow>

# ====================================
# GOOGLE SERVICES
# ====================================

# Google Calendar
GOOGLE_CALENDAR_ID=<REQUIRED - Example: abc123@group.calendar.google.com>
GOOGLE_CALENDAR_CREDENTIAL_ID=<SET_AFTER_N8N_SETUP>

# Google Tasks
GOOGLE_TASKS_LIST_ID=<REQUIRED - Example: MTIzNDU2Nzg5MA>
GOOGLE_TASKS_CREDENTIAL_ID=<SET_AFTER_N8N_SETUP>

# Google Gemini AI
GOOGLE_GEMINI_API_KEY=<REQUIRED - Get from: https://makersuite.google.com/app/apikey>
GOOGLE_GEMINI_CREDENTIAL_ID=<SET_AFTER_N8N_SETUP>

# ====================================
# TELEGRAM
# ====================================
TELEGRAM_BOT_TOKEN=<REQUIRED - Get from: @BotFather>
TELEGRAM_INTERNAL_CHAT_ID=<REQUIRED - Get from: @userinfobot>
TELEGRAM_BOT_CREDENTIAL_ID=<SET_AFTER_N8N_SETUP>

# ====================================
# CLINIC BUSINESS INFORMATION
# ====================================
CLINIC_NAME=Clínica Moreira
CLINIC_ADDRESS=<REQUIRED - Full address>
CLINIC_PHONE=<REQUIRED - Format: +5531999999999>
CLINIC_EMAIL=<REQUIRED - Contact email>

# Business Hours
CLINIC_HOURS_START=08:00
CLINIC_HOURS_END=19:00
CLINIC_DAYS_OPEN=Segunda a Sábado

# Public Resources
CLINIC_CALENDAR_PUBLIC_LINK=<REQUIRED - Public Google Calendar embed URL>
CLINIC_WEBSITE=<OPTIONAL - Clinic website>

# ====================================
# MCP (Model Context Protocol) ENDPOINTS
# ====================================
MCP_CALENDAR_ENDPOINT=<REQUIRED - MCP Calendar SSE endpoint>
MCP_GMAIL_ENDPOINT=<OPTIONAL - MCP Gmail SSE endpoint>

# ====================================
# EVOLUTION API CREDENTIALS (For n8n nodes)
# ====================================
EVOLUTION_API_CREDENTIAL_ID=<SET_AFTER_N8N_SETUP>

# ====================================
# MONITORING & ALERTS
# ====================================

# Sentry (Error Tracking - Optional)
SENTRY_DSN=<OPTIONAL>
SENTRY_ENVIRONMENT=production

# Prometheus (Metrics - Optional)
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# ====================================
# BACKUP & RECOVERY
# ====================================

# Backup Schedule
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_LOCATION=/backups

# ====================================
# RATE LIMITING & PERFORMANCE
# ====================================

# API Rate Limits
API_RATE_LIMIT_WINDOW=60000
API_RATE_LIMIT_MAX_REQUESTS=60

# WhatsApp Rate Limits
WHATSAPP_MESSAGES_PER_SECOND=1
WHATSAPP_DAILY_LIMIT=1000

# ====================================
# SSL/TLS CONFIGURATION (If using reverse proxy)
# ====================================
SSL_ENABLED=true
SSL_CERT_PATH=/etc/ssl/certs/clinic.crt
SSL_KEY_PATH=/etc/ssl/private/clinic.key

# ====================================
# DEPLOYMENT INFORMATION
# ====================================
DEPLOY_DATE=<FILLED_BY_DEPLOYMENT_SCRIPT>
DEPLOY_VERSION=1.0.0
DEPLOY_ENVIRONMENT=production

# ====================================
# HEALTH CHECK ENDPOINTS
# ====================================
HEALTHCHECK_PATH=/healthz
HEALTHCHECK_INTERVAL=30

# ====================================
# CORS CONFIGURATION (If using web interface)
# ====================================
CORS_ENABLED=true
CORS_ORIGIN=https://yourdomain.com

# ====================================
# NOTES & REMINDERS
# ====================================
# 
# POST-DEPLOYMENT CHECKLIST:
# □ All <REQUIRED> fields filled
# □ All secrets generated and documented
# □ Backup of N8N_ENCRYPTION_KEY stored securely
# □ SSL certificates installed and valid
# □ Firewall rules configured
# □ Health checks passing
# □ Monitoring alerts configured
# □ Error workflow tested
# □ WhatsApp instance connected
# □ Google Calendar connected
# □ Telegram bot responding
# □ End-to-end test completed
# 
# SECURITY REMINDERS:
# - Rotate all passwords every 90 days
# - Review access logs weekly
# - Update Docker images monthly
# - Monitor error rates daily
# - Backup encryption key offline
# 
# EMERGENCY CONTACTS:
# DevOps: <ADD_CONTACT>
# System Admin: <ADD_CONTACT>
# Database Admin: <ADD_CONTACT>
#
# ====================================

